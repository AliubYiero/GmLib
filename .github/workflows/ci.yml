name: Build and Release

on:
    push:
        branches:
            - master
    pull_request:
        branches:
            - master

jobs:
    build:
        runs-on: ubuntu-latest  # 使用最新的 Ubuntu 运行环境
        
        steps:
            # Step 1: Check out the code
            -   name: Check out the repository
                uses: actions/checkout@v3
            
            # Step 2: Set up Node.js
            -   name: Set up Node.js
                uses: actions/setup-node@v3
                with:
                    node-version: '16'  # 设置 Node.js 版本
            
            # Step 3: Install dependencies
            -   name: Install dependencies
                run: npm install
            
            # Step 4: Run npm build
            -   name: Run npm build
                run: npm run build  # 运行构建命令
            
            
            # Step 5: Create zip file for release
            -   name: Create zip file for release
                run: |
                    mkdir release
                    cp README.md package.json -r dist release/
                    cd release
                    zip -r release.zip .  # 压缩文件内容
            
            # Step 6: Upload the release asset to GitHub Releases
            -   name: Create Release and Upload Release Asset
                uses: softprops/action-gh-release@v2
                if: startsWith(github.ref, 'refs/tags/')
                with:
                    tag_name: ${{ github.ref }}
                    name: Release ${{ github.ref }}
                    body: TODO New Release.
                    draft: false
                    prerelease: false
                    files: |
                        release/release.zip
                        LICENSE
